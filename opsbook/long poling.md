# Ajax long pooling
---

1. 反向Ajax
2. 轮训(polling)
3. 流(streaming)
4. Comet
5. 长轮训(long polling)


## 反向Ajax技术
反向Ajax（Reverse Ajax）本质上则是这样的一种概念：能够从服务器端向客户端发送数据。在一个标准的HTTP Ajax请求中，数据是发送给服务器端的，反向Ajax可以某些特定的方式来模拟发出一个Ajax请求，这些方式本文都会论及，这样的话，服务器就可以尽可能快地向客户端发送事件（低延迟通信）。

### HTTP轮询和JSONP轮询
轮询的时间间隔
JSONP轮询基本上与HTTP轮询一样，不同之处则是JSONP可以发出跨域请求（不是在你的域内的请求）。清单1使用JSONP来通过邮政编码获取地名，JSONP请求通常可通过它的回调参数和返回内容识别出来，这些内容是可执行的JavaScript代码。

清单2. JavaScript轮询

```
setInterval(function() {
　　$.getJSON('events', function(events) {
　　　　console.log(events);
　　});
}, 2000);
```

优点: 容易实现
缺点: 不具有伸缩性, 消耗资源大

###Piggyback
`捎带轮询（piggyback polling）`是一种比轮询更加聪明的做法. 它是一种半主动的方式，也就是说还是由Browser主动发出请求，但是每次请求的响应中除了当次的响应之外，还会把上次请求以来已经发生的变化同时发给Browser。也就是说，当次请求的更新会搭载到下一次请求的响应一并发回。这样，在Browser的感觉就好像上一次请求又有了更新。但是这种感觉取决于Browser向Server发出请求的频率。如果，第二次请求迟迟没有发出，那么上一次的更新就不会取到。

你可以看到表单验证的结果和附加到响应上的事件，同样，这种方法也有着一些优点和缺点：

**优点**：没有不返回数据的请求，因为客户端对何时发送请求做了控制，对资源的消耗较少。该方法也是可用在所有的浏览器上，不需要服务器端的特殊功能。
**缺点**：当累积在服务器端的事件需要传送给客户端时，你却一点都不知道，因为这需要一个客户端行为来请求它们。

### Comet
使用了轮询或是捎带的反向Ajax非常受限：其不具伸缩性，不提供低延迟通信（只要事件一到达服务器端，它们就以尽可能快的速度到达浏览器端）。Comet是一个web应用模型，在该模型中，请求被发送到服务器端并保持一个很长的存活期，直到超时或是有服务器端事件发生。在该请求完成后，另一个长生存期的Ajax请求就被送去等待另一个服务器端事件。使用Comet的话，web服务器就可以在无需显式请求的情况下向客户端发送数据。

Comet的一大优点是，每个客户端始终都有一个向服务器端打开的通信链路。服务器端可以通过在事件到来时立即提交（完成）响应来把事件推给客户端，或者它甚至可以累积再连续发送。因为请求长时间保持打开的状态，故服务器端需要特别的功能来处理所有的这些长生存期请求。图3给出了一个例子。（这一文章系列的第2部分会更加详细地解释服务器端的约束条件）。

Comet的实现可以分成两类：`使用流（streaming）`的那些和`使用长轮询`（long polling）的那些.

#### 使用HTTP流Comet

